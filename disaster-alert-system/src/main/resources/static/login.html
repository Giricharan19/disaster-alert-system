<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Login</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
:root{
  --bg1:#0f2027;
  --bg2:#203a43;
  --bg3:#2c5364;
  --card:#0f151a;
  --input:#162026;
  --accent:#20e38a;
  --accent-dark:#0fb063;
  --text:#e9f7f1;
  --muted:#9bb1b9;
  --error:#ff6b6b;
}

*{
  box-sizing:border-box;
  font-family:Inter,Arial;
}

body{
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
}

/* ===== CARD ===== */
.card{
  width:380px;
  background:var(--card);
  padding:28px;
  border-radius:16px;
  box-shadow:0 14px 40px rgba(0,0,0,.65);
  color:var(--text);
  transition:transform .3s ease, box-shadow .3s ease;
}
.card:hover{
  transform:translateY(-6px);
  box-shadow:0 20px 55px rgba(0,0,0,.8);
}

h2{
  text-align:center;
  margin-bottom:22px;
}

/* ===== INPUTS ===== */
input,select{
  width:100%;
  height:48px;
  margin:12px 0;
  padding:0 14px;
  border-radius:12px;
  border:none;
  background:var(--input);
  color:var(--text);
  outline:none;
  transition:border .2s ease, box-shadow .2s ease, transform .2s ease;
}

input:hover, select:hover{
  transform:scale(1.01);
}

input:focus, select:focus{
  box-shadow:0 0 0 2px var(--accent);
}

/* ===== BUTTON ===== */
button{
  width:100%;
  height:48px;
  margin-top:18px;
  border-radius:12px;
  border:none;
  background:linear-gradient(180deg,var(--accent),var(--accent-dark));
  font-weight:700;
  cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease, opacity .2s ease;
}

button:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 20px rgba(32,227,138,.4);
}

button:active{
  transform:scale(.98);
}

button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

/* ===== TEXT ===== */
.small{
  margin-top:14px;
  text-align:center;
  font-size:13px;
  color:var(--muted);
}

a{
  color:var(--accent);
  font-weight:600;
  text-decoration:none;
}

a:hover{
  text-decoration:underline;
}

#msg{
  margin-top:14px;
  text-align:center;
  color:var(--error);
  font-size:13px;
  min-height:18px;
}
</style>
</head>

<body>

<div class="card">
  <h2>Login</h2>

  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">

  <select id="role">
    <option value="CITIZEN">Citizen</option>
    <option value="RESPONDER">Responder</option>
    <option value="ADMIN">Admin</option>
  </select>

  <button id="loginBtn" onclick="login()">Login</button>

  <div class="small">
    New user? <a href="register.html">Create account</a>
  </div>

  <div id="msg"></div>
</div>

<script>
async function login(){
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;
  const role = document.getElementById("role").value;
  const msg = document.getElementById("msg");
  const btn = document.getElementById("loginBtn");

  msg.textContent = "";

  if(!email || !password){
    msg.textContent = "Email and password are required";
    return;
  }

  btn.disabled = true;
  btn.textContent = "Logging in...";

  try{
    const res = await fetch("http://localhost:8163/api/auth/login",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ email, password, role })
    });

    const data = await res.text();

    if(!res.ok){
      msg.textContent = data;
      btn.disabled = false;
      btn.textContent = "Login";
      return;
    }

    const user = JSON.parse(data);
    localStorage.setItem("loggedUser", JSON.stringify(user));

    // ROLE BASED REDIRECT
    if(user.role === "ADMIN"){
      window.location.href = "dashboard.html";
    }else if(user.role === "RESPONDER"){
      window.location.href = "dashboard.html";
    }else{
      window.location.href = "dashboard.html";
    }

  }catch(err){
    msg.textContent = "Server error. Please try again.";
  }

  btn.disabled = false;
  btn.textContent = "Login";
}
</script>

</body>
</html>
